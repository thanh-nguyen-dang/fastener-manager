# Fastener Management System

## Introduction

The **Fastener Management System** is a Django-based web application that allows users to manage sellers and fasteners. Sellers can upload fastener data using CSV files, and the application processes and stores this data efficiently. The system supports both `metric` and `imperial` thread sizes, converting between units and standardizing the data.

This project integrates **Redis** for caching purposes to enhance the performance of API responses, particularly in retrieving large datasets like fasteners. The application is containerized using Docker for easy deployment and consistent environment configuration.

### Structure Overview

- **Django Models**:
  - `Seller`: Stores seller information along with CSV mapping configurations for data ingestion.
  - `Fastener`: Stores fastener information, including thread sizes and types (metric or imperial).
  - Other related models include `ThreadSize`, `Material`, `Finish`, and `Category` for better classification and filtering.

- **Standardizers**: Functions that help clean and standardize the data, such as converting thread sizes between metric and imperial systems.
- **Metric converter**: FUnctions that help convert between metric and imperial unit so that we can sort by thread size
- **Redis Caching**: Redis is integrated to store frequently accessed data (e.g., lists of fasteners) to reduce database load and improve response times. The cache is invalidated when new fasteners are ingested.



### Approach Using Django and Redis

- **Django**: 
  - Django is used as the main web framework, leveraging the Django REST Framework (DRF) to build RESTful APIs for sellers and fasteners.
  - Custom Django models are used to store information about sellers and fasteners, while custom validation and data standardization functions ensure that data is consistent and follows the required format.

- **Redis**:
  - Redis is used as a caching layer to speed up GET requests, such as listing fasteners. The cache is invalidated when new fasteners are ingested to ensure that users always get the latest data.
  - The cache is automatically updated when a user retrieves fasteners, which helps reduce database queries for frequently accessed data.

### Features

- Add sellers with custom CSV mappings for fastener data ingestion.
- Upload fastener data via CSV files.
- Standardize thread sizes (imperial and metric).
- Cache fastener list for better performance.
- Retrieve the list of fasteners with sorting options.

## File structure
```markdown
Fastener-Management-System/
│
├── fastener_app/                    # Main Django application directory
│   ├── migrations/                  # Directory for database migration files
│   │   ├── __init__.py              # Marks this directory as a Python package
│   │   └── 0001_initial.py          # Initial migration file (auto-generated by Django)
│   ├── models                       # Contains the database models (Seller, Fastener, ThreadSize, etc.)
│   │   ├── __init__.py
│   │   ├── category.py
│   │   ├── constants.py
│   │   ├── fastener.py
│   │   ├── finish.py
│   │   ├── material.py
│   │   ├── seller.py
│   │   ├── seller_catagory.py
│   │   ├── thread_size.py
│   ├── tests/                       # Directory containing unit tests
│   │   ├── __init__.py              # Marks this directory as a Python package
│   │   ├── conftest.py              # Pytest fixture configuration for setting up test data
│   │   ├── factories.py             # Implement factories model of factory_boy to generate test data
│   │   ├── test_models.py           # Unit tests for the Django models
│   │   ├── test_standardize.py      # Unit tests for the standardize functions
│   │   ├── test_view_ingest.py      # Unit tests for the Fastener Ingest view
│   │   ├── test_view_list.py        # Unit tests for the Fastener List view (API endpoints)
│   │   ├── test_view_seller.py      # Unit tests for the Seller view (API endpoints)
│   ├── views                        # API views to handle requests (CRUD operations for sellers, fasteners)
│   │   ├── __init__.py
│   │   ├── fastener.py
│   │   ├── fastener_ingest.py
│   │   ├── seller.py
│   ├── __init__.py                  # Marks this directory as a Python package
│   ├── serializers.py               # Serializes and deserializes models for API interaction
│   ├── standardizers.py             # Functions to standardize raw data (e.g., thread size, material)
│   ├── urls.py                      # URL routing for API endpoints (sellers and fasteners)
│
├── fastener_manager                 # Configuration module
│   ├── __init__.py
│   ├── asgi.py                      # configuration for async app
│   ├── settings.py                  # app and Django settings
│   ├── test_settings.py             # Django settings for test
│   ├── urls.py                      # url defined for root
│   ├── wsgi.py                      # configuration for web synchronous app
│
├── scripts/                         # Directory containing helper bash scripts for running the project
│   ├── run_app.sh                   # Script to build and run the application with Docker Compose
│   ├── run_test.sh                  # Script to run unit tests using pytest
│   ├── database_setup.sh            # Script to set up and tear down the PostgreSQL database
│   ├── import_sellers.sh            # Script to make a POST request to import sellers via JSON file
│   ├── import_fasteners.sh          # Script to make a POST request to ingest fasteners from a CSV file
│   ├── list_fasteners.sh            # Script to send a GET request and list all fasteners
│
├── docker-compose.yml               # Docker Compose configuration (for Django, PostgreSQL, Redis)
├── Dockerfile                       # Dockerfile for building the Django app container
├── manage.py                        # Django’s management script (for running server, migrations, etc.)
├── pytest.ini                       # configuration for pytest
├── README.md                        # Documentation for the project (setup instructions, API usage)
├── requirements.txt                 # Python dependencies (Django, DRF, Redis, pytest, etc.)
├── .env                             # Environment variables for the application (used by Django, PostgreSQL, Redis)
├── .test_env                        # Environment variables for testing environment
```

## Instructions
### 1. Install virtual environment
To avoid damaging Python of host machine, we use pyenv to manage virtual environment.
Run following command to setup virtual environment.

```bash
./scripts/setup_pyenv.sh
```

This script will:
- install `pyenv`
- install `python 3.10.7`
- create a virtual environment name `fastener_manager`
- THen, you can run `pyenv activate fastener_manager` to set your Python to fastener_manager

### 2. Run Unit Tests

The project uses `pytest` for unit testing. The tests ensure that the models, views, and standardizers work as expected. To run the unit tests, follow these steps:

#### Run Unit Tests with Docker Compose

Make sure to create a `.test_env` file in the `scripts` directory with your environment variables configured for testing.

```bash
# Navigate to the project directory
./scripts/run_test.sh fastener_manager fastener_app
```

### 3. Run the Application
The application is configured to run in a Docker environment using Docker Compose. This includes PostgreSQL as the database, Redis as the caching layer, and Django as the web server.

To run the application:
1. Ensure that Docker and Docker Compose are installed on your system.
2. Build and start the containers:
```bash
./scripts/run_app.sh fastener_manager
```

### 4. Run REST request to test application
Now, service is running, you can run
```bash
./scripts/import_sellers.sh                   # To import seller from data_sample/sellers.json
./scripts/import_fasteners.sh                 # To import fasteners from sellers-a.csv and sellers-b.csv in data_sample
./scripts/list_fasteners.sh                   # To list all fasterners.
```

Please feel free to edit bash file to test arbitrary query.